## **EDM智能投递网关 - MVP版产品需求规格说明书 (PRD)**

| **文档版本** | **状态**         | **作者** | **更新日期**      | **主要变更**                               |
| :----------- | :--------------- | :------- | :---------------- | :----------------------------------------- |
| **v1.0**     | **准备开发** | **策华**   | **2025年6月25日** | **基于讨论创建的初始版本** |

### **1. 引言与背景**

#### **1.1 项目概述**

本项目旨在开发一款EDM（电子邮件营销）智能投递网关的最小可行产品（MVP）。它并非一个简单的邮件发送工具，而是一个定位为开发者和企业提供更上层服务的 **“智能邮件投递网关”**。产品形态为一个SaaS平台，通过API驱动，为其他应用程序提供稳定、高效、可追踪的邮件发送能力。

#### **1.2 项目背景与目标 (Why)**

当前，开发者或企业直接使用底层云服务商（如阿里云邮件推送、Mailgun等）的邮件服务时，普遍面临以下痛点：
*   **供应商限制**：单一供应商的账号存在发送额度、频率限制，容易触及天花板。
*   **多账号管理复杂**：为规避限制而开设多个账号，导致管理、维护和成本核算变得复杂。
*   **账号“养护”成本**：新账号需要时间“养护”以建立信誉度，否则发送成功率和到达率无法保证。
*   **数据孤岛**：不同账号、不同供应商之间的数据是割裂的，难以形成统一的、有价值的数据洞察。

本产品旨在通过建立一个 **“预置资源池”** 和 **“智能调度层”**，为用户屏蔽底层供应商的复杂性，提供一个更稳定、更高送达率、更易于管理的统一邮件发送解决方案。

### **2. 目标与衡量指标**

#### **2.1 业务目标**

*   **市场验证**：验证“智能投递网关”模式的市场接受度和商业价值。
*   **基础设施赋能**：为公司内部其他应用提供统一、可靠的邮件发送基础设施。
*   **种子用户获取**：通过简洁高效的MVP产品，吸引首批核心用户。

#### **2.2 用户目标**

*   **应用管理员**：能够快速、安全地在平台上获取API密钥，并将其轻松配置到业务应用中，无需关心底层技术细节。
*   **产品/运营人员**：能够通过简洁的后台，清晰地监控邮件发送用量，并查看按活动分组的邮件投递效果（特别是打开率和点击率）。

#### **2.3 成功衡量指标 (Success Metrics)**

| 指标类别 | 关键指标 (KPI)                 | 目标值                | 备注                                           |
| :------- | :----------------------------- | :-------------------- | :--------------------------------------------- |
| **技术性能** | API 调用成功率 (非4xx/5xx错误)   | > 99.5%               | 衡量API端点的稳定性                            |
|          | API 响应时间 (P95)             |  99.9%               | 核心服务的在线时间比例                         |
| **业务效果** | 核心邮件送达率 (Delivery Rate) | > 95%                 | 衡量资源池的质量                               |
|          | **用户激活率** (Activation Rate) | > 70%                 | （验证域名并创建首个API密钥的用户 / 注册用户） |
|          | **免费额度使用率**             | > 50%                 | （至少发送过一封邮件的用户 / 注册用户）        |

### **3. 目标用户与核心场景**

#### **3.1 目标用户画像 (Persona)**

**主要用户：应用管理员 / 运营配置人员 (李明)**

*   **角色**：某SaaS公司的技术运营或初级开发者。
*   **任务**：负责维护线上应用，当应用需要集成邮件发送功能时（如发送注册验证码、订单通知），他需要找到一个可靠的服务并完成配置。
*   **痛点**：他不想深入研究各家邮件服务商复杂的SDK和API文档，也不想处理IP信誉度、发送限制等麻烦事。他需要的是一个“即插即用”的解决方案。
*   **核心诉求**：“给我一个API Key，告诉我怎么用，让它稳定工作就行了。”

#### **3.2 核心用户旅程 (User Journey)**

1.  **注册与登录**：李明访问平台，使用邮箱注册账号并完成登录。
2.  **获取免费额度**：系统自动为李明的账户添加100封免费发送额度。
3.  **添加并验证域名**：李明在后台添加自己公司的发信域名（如 `service@mycompany.com`），平台提供几条DNS记录（SPF, DKIM, CNAME），他前往域名服务商处完成配置，平台后台自动验证。
4.  **创建与复制API密钥**：域名验证通过后，李明在后台创建一个API密钥，并一键复制。
5.  **配置与使用**：李明将复制的API密钥粘贴到公司内部应用的后台配置中。该应用开始通过此密钥调用我们的API发送邮件。
6.  **监控与分析**：几天后，李明或其同事登录平台，在“数据总览”查看总用量消耗，在“活动报告”中查看特定活动（如“双十一促销”）的邮件打开率和点击率。

### **4. 用户故事与功能需求**

#### **4.1 用户认证与账户管理**

*   **用户故事**: 作为一名新用户，我希望能用邮箱快速注册并登录平台，以便开始使用服务。
*   **功能需求**:
    *   用户注册（邮箱验证）。
    *   用户登录（邮箱+密码）、密码重置。
    *   **额度管理**：
        *   新用户注册成功后，账户自动获得 **100封** 免费邮件发送额度。
        *   在账户仪表盘显著位置展示“总额度”、“已用额度”、“剩余额度”。
        *   当额度不足时，API调用将失败并返回特定错误码，Web界面将给出提示。
        *   当额度低于10%时，向用户注册邮箱发送提醒邮件。
    *   **套餐购买 (MVP简化)**：提供套餐展示页，引导用户联系商务进行人工充值。

#### **4.2 API密钥管理**

*   **用户故事**: 作为一名应用管理员，我希望能轻松地创建、复制和管理我的API密钥，以便安全地将其配置到我的应用中。
*   **功能需求**:
    *   **创建密钥**：用户输入“密钥名称”即可生成。
    *   **查看密钥**：API密钥在列表中**始终完整可见**，并提供“一键复制”按钮。
    *   **删除密钥**：可随时删除不再使用的密钥。
    *   **权限说明**：MVP阶段所有密钥权限相同，无需配置。

#### **4.3 发信域名管理**

*   **用户故事**: 作为用户，我希望能添加我自己的发信域名，并根据清晰的指引完成验证，以便平台能代表我发送邮件，提高可信度。
*   **功能需求**:
    *   添加域名。
    *   为每个域名生成专属的、需要用户配置的DNS记录（SPF, DKIM, CNAME）。
    *   系统后台自动、定期检查DNS记录配置状态，并更新域名验证状态（待验证、验证中、已验证、验证失败）。

#### **4.4 邮件发送 (核心API)**

*   **用户故事**: 作为一名开发者，我希望能调用一个简单的API来发送邮件，并能通过附加一个“活动ID”来分组邮件，以便后续进行数据分析。
*   **功能需求**:
    *   提供`POST /api/v1/send`和`POST /api/v1/send/batch`接口。
    *   接口通过Bearer Token（即API密钥）进行认证。
    *   请求体中支持一个**可选字段 `campaign_id`** (字符串类型)，用于标记活动。
    *   系统后台自动为所有外发邮件注入**打开追踪像素**和**点击追踪链接重写**。
    *   系统后台根据内部资源池情况，**智能选择**最佳的阿里云账号通道进行投递。

#### **4.5 数据与活动分析**

*   **用户故事**: 作为一名运营人员，我希望能在一个集中的仪表盘上看到整体的邮件发送情况，并且能下钻到某个具体的活动，查看其送达率、打开率和点击率。
*   **功能需求**:
    *   **数据总览页**：展示账户级的核心指标（总发送量、总送达量、平均送达率、总打开率、总点击率、剩余额度）。
    *   **活动报告页**：
        *   以列表形式展示所有通过API `campaign_id` 传递过的活动。该列表是**自动发现和生成**的，无需手动创建。
        *   每个活动列表项展示其核心汇总数据（发送量、送达率、打开率、点击率）。
        *   提供基础的数据可视化图表。

### **5. 非功能性需求**

| 类别 | 需求描述 |
| :--- | :--- |
| **性能** | **API响应时间**: 邮件发送API (`/send`) 接收请求并成功入队，应在2秒内返回响应（HTTP 202 Accepted）。**并发能力**: API入口需能承受至少 500 QPS 的并发请求。**处理能力**: 后台系统需能稳定处理单次请求高达10万收件人的批量任务。 |
| **可靠性** | **服务可用性**: 核心服务（API网关、用户后台）可用性需达到 **99.9%**。**异步处理**: 邮件发送请求必须采用异步处理架构（API网关 -> 消息队列 -> 后台Worker），确保API入口的高可用和高响应性。 |
| **安全性** | **传输安全**: 全站及API必须使用HTTPS加密传输。**认证安全**: API调用必须通过API密钥进行认证。**频率限制**: 对API调用实施合理的速率限制（如：100次/分钟/密钥），防止滥用，并在超出时返回`429 Too Many Requests`。 |
| **兼容性** | **浏览器**: Web后台需兼容主流现代浏览器（Chrome, Firefox, Safari, Edge）的最新版本。**API标准**: API需遵循RESTful设计风格，使用JSON数据格式。 |

### **6. API 核心接口设计 (摘要)**

#### **认证与密钥**

*   `POST /api/auth/login` (用户登录)
*   `POST /api/auth/api-keys` (生成API密钥)
    *   Body: `{ "name": "密钥名称" }`

#### **邮件发送**

*   `POST /api/v1/send` (单封发送)
    *   Headers: `Authorization: Bearer {api_key}`
    *   Body:
        ```json
        {
          "to": ["email1@example.com"],
          "subject": "邮件主题",
          "html": "...",
          "from": "sender@yourdomain.com",
          "campaign_id": "q3_promo_event" // 可选
        }
        ```

#### **数据分析**

*   `GET /api/analytics/overview` (获取总览数据)
*   `GET /api/analytics/campaigns` (获取活动列表)
*   `GET /api/analytics/campaigns/{campaign_id}` (获取单个活动详情)

### **7. 验收标准 (Acceptance Criteria) 示例**

**场景：新用户激活与首次发送**
*   **Given**: 一个新用户"李明"完成了注册。
*   **When**: 他登录后台。
*   **Then**: 他能看到自己的账户有100封免费额度。
*   **And When**: 他成功验证了域名，创建了API密钥，并通过API发送了1封标记了`campaign_id: "test_run"`的邮件。
*   **Then**: 他的剩余额度应变为99封。
*   **And Then**: 在“活动报告”页面，应能看到一个名为“test_run”的活动，其发送量为1。

### **8. 设计与交互指引**

*   **设计原则**: 界面风格应追求**极简、清晰、工具化**。避免不必要的装饰和复杂的交互。
*   **核心页面**:
    1.  **仪表盘/首页**: 核心数据指标和剩余额度一目了然。
    2.  **API密钥管理页**: 列表清晰展示密钥名称和密钥本身，复制按钮非常显眼。
    3.  **域名管理页**: 清晰展示每个域名的状态和需要配置的DNS记录。
    4.  **活动报告页**: 数据驱动，以图表和关键数字为主。

### **9. 超出范围 / 未来考虑 (Out of Scope for MVP)**

为确保MVP的聚焦和快速交付，以下功能明确排除在本次范围之外：

*   复杂的所见即所得（WYSIWYG）邮件编辑器。
*   在Web界面上管理收件人列表和创建、发送邮件活动。
*   多租户权限管理（用户角色、团队协作）。
*   多权限类型的API密钥。
*   完整的安全审计日志。
*   官方多语言SDK包（如Node.js, Python）。
*   面向公众的、可交互的API文档站（初期以内部分享为主）。
*   自助式在线支付网关集成。
*   A/B测试功能。
